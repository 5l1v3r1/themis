<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Java/Android - Themis 0.9</title>

        <link href="../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../index.html">Themis 0.9</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../index.html">Introduction</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">How to use <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../2.-How-to-use-Themis/index.html">Intro</a>
                        </li>
                    
                        <li >
                            <a href="../2.1-Building-and-installing/index.html">Building and installing</a>
                        </li>
                    
                        <li >
                            <a href="../2.2-Objects-reference/index.html">Objects reference</a>
                        </li>
                    
                        <li >
                            <a href="../2.3-Key-management/index.html">Key management advice</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Language reference <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../2.4-Language-reference/index.html">Intro</a>
                        </li>
                    
                        <li >
                            <a href="../2.4.1-Python-Howto/index.html">Python</a>
                        </li>
                    
                        <li >
                            <a href="../2.4.2-PHP-Howto/index.html">PHP</a>
                        </li>
                    
                        <li >
                            <a href="../2.4.3-Ruby-Howto/index.html">Ruby</a>
                        </li>
                    
                        <li >
                            <a href="../2.4.4-Objective-C-Howto/index.html">Objective C</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Java/Android</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../3.-FAQ/index.html">FAQ</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Fundamentals <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../4.1-General-design-principles/index.html">General design principles</a>
                        </li>
                    
                        <li >
                            <a href="../4.2-Architecture/index.html">Architecture</a>
                        </li>
                    
                        <li >
                            <a href="../4.3-Soter-cryptostack/index.html">Soter cryptostack</a>
                        </li>
                    
                        <li >
                            <a href="../4.4-Cryptosystems/index.html">Cryptosystems</a>
                        </li>
                    
                        <li >
                            <a href="../4.4.1-Secure-message/index.html">Secure Message</a>
                        </li>
                    
                        <li >
                            <a href="../4.4.2-Secure-Session/index.html">Secure Session</a>
                        </li>
                    
                        <li >
                            <a href="../4.4.3-Secure-Cell/index.html">Secure Cell</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributing <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../5.-Contributing-to-Themis/index.html">Intro</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributing  <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../5.1-Development-status/index.html">Development roadmap</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributing <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../5.2-Getting-started-with-development/index.html">Getting started with development</a>
                        </li>
                    
                        <li >
                            <a href="../5.3-Directory-structure/index.html">Directory structure</a>
                        </li>
                    
                        <li >
                            <a href="../5.4-Implementation-details/index.html">Some implementation details</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
           <ul class="nav navbar-nav navbar-right">

                
                <li>
                    <a href="https://github.com/cossacklabs/themis/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#java-android">Java / Android</a></li>
        
            <li><a href="#using-themis-in-android-applications">Using Themis in Android applications</a></li>
        
            <li><a href="#keypair-generation">Keypair generation</a></li>
        
            <li><a href="#usage">Usage</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="java-android">Java / Android</h1>
<h2 id="using-themis-in-android-applications">Using Themis in Android applications</h2>
<ol>
<li>Build Themis for Android as described in <a href="../2.1-Building-and-installing/index.html">Building and installing Themis</a></li>
<li>Import Themis AAR to your application project in Android Studio or reference it in your gradle.build file. More about using libraries <a href="http://tools.android.com/tech-docs/new-build-system/user-guide">here</a>.</li>
</ol>
<h2 id="keypair-generation">Keypair generation</h2>
<p>You can generate keypairs easily for <a href="../4.4.1-Secure-message/index.html">secure message</a> and <a href="../4.4.2-Secure-Session/index.html">secure session</a> like this:</p>
<pre><code>Keypair pair = KeypairGenerator.generateKeypair();
PrivateKey privateKey = pair.getPrivateKey();
PublicKey publicKey = pair.getPublicKey();
</code></pre>
<blockquote>
<p>WARNING: When you distribute private keys to your users, make sure they are sufficiently protected. You can find guidelines <a href="../2.3-Key-management/index.html">here</a>.</p>
<p>NOTE: When using public keys of other peers, make sure they come from trusted sources.</p>
</blockquote>
<h2 id="usage">Usage</h2>
<h3 id="secure-message">Secure message</h3>
<h4 id="sending-many-messages-to-same-recipient">Sending many messages to same recipient</h4>
<ol>
<li>
<p>Create SecureMessage object with your PrivateKey and recipient's PublicKey:</p>
<pre><code>SecureMessage encryptor = new SecureMessage(yourPrivateKey, peerPublicKey);
</code></pre>
</li>
<li>
<p>Encrypt each outgoing message:</p>
<pre><code> byte[] encryptedMessage = encryptor.wrap(messageToSend);
</code></pre>
</li>
<li>
<p>Decrypt each incoming message:</p>
<pre><code> byte[] receivedMessage = encryptor.unwrap(wrappedMessage);
</code></pre>
</li>
</ol>
<h4 id="sending-messages-to-many-recipients">Sending messages to many recipients</h4>
<ol>
<li>
<p>Create SecureMessage object with your PrivateKey:</p>
<pre><code>SecureMessage encryptor = new SecureMessage(yourPrivateKey);
</code></pre>
</li>
<li>
<p>Encrypt each outgoing message specifying recipients' PublicKey:</p>
<pre><code>byte[] encryptedMessage = encryptor.wrap(messageToSend, peerPublicKey);
</code></pre>
</li>
<li>
<p>Decrypt each incoming message specifying sender's PublicKey:</p>
<pre><code>byte[] receivedMessage = encryptor.unwrap(wrappedMessage, peerPublicKey);
</code></pre>
</li>
</ol>
<h3 id="secure-cell">Secure cell</h3>
<ol>
<li>
<p>Create SecureCell object to protect your data</p>
<pre><code>SecureCell cell = new SecureCell(yourSecretByteArrayKey);
</code></pre>
<p>or</p>
<pre><code>SecureCell cell = new SecureCell("your secret password string");
</code></pre>
<p>You may specify mode as well:</p>
<pre><code> SecureCell cell = new SecureCell("your secret password string", SecureCell.MODE_TOKEN_PROTECT);
</code></pre>
<blockquote>
<p>NOTE: If not specified, Secure Cell will use <code>SecureCell.MODE_SEAL</code> by default. More about Secure Cell modes and which to choose <a href="../4.4.3-Secure-Cell/index.html">here</a>.</p>
</blockquote>
</li>
<li>
<p>Protect your data:</p>
<pre><code>SecureCellData cellData = cell.protect(context, data);
</code></pre>
<blockquote>
<p>NOTE: Context is optional.</p>
</blockquote>
<p>The result of the function call is <code>SecureCellData</code> object which is a simple container for protected data. You may get actual protected data:</p>
<pre><code>byte[] protectedData = cellData.getProtectedData();
</code></pre>
<p>Depending on the mode selected it may also have additional data (which is opaque to the user but necessary for successful decryption):</p>
<pre><code>if (cellData.hasAdditionalData() {
    byte[] additionalData = cellData.getAdditionalData();
}
</code></pre>
<p>You may also use one object to encrypt different data with different keys:</p>
<pre><code>SecureCellData cellData1 = cell.protect(key1, context1, data1);
...
SecureCellData cellData2 = cell.protect(key2, context2, data2);
...
</code></pre>
</li>
<li>
<p>Recover your data:</p>
<pre><code>byte[] data = cell.unprotect(context, cellData);
</code></pre>
<blockquote>
<p>NOTE: Context should be same as in protect call for successful decryption.</p>
</blockquote>
</li>
</ol>
<h3 id="secure-session">Secure session</h3>
<h4 id="secure-sockets">Secure sockets</h4>
<p>If your application already uses Java sockets for communication you can easily add security by replacing them with our <code>SecureSocket</code> and <code>SecureServerSocket</code></p>
<ol>
<li>Implement <code>ISessionCallbacks</code> interface:</li>
<li><code>getPublicKeyForId</code> which will return peer's trusted public key when needed by the system</li>
<li>
<p><code>stateChanged</code> is just a notification callback. You may use it for informational purpose, to update your UI or just have a dummy (do-nothing) implementation</p>
<p>Example using anonymous class:</p>
<pre><code>ISessionCallbacks callbacks = new ISessionCallbacks() {
    @Override
    public PublicKey getPublicKeyForId(SecureSession session, byte[] id) {
        // get trusted PublicKey of user id
        PublicKey publicKey = getUserPublicKeyFromDatabaseOrOtherStorageOrSource(id);
        return publicKey; // or null if key is not found
    }

    @Override
    public void stateChanged(SecureSession session) {
        // update UI: for example, draw a nice lock indicating to the user that his communication is now secured
    }
}
</code></pre>
</li>
<li>
<p>Replace all your sockets with our secure versions:</p>
<p>on client:</p>
<pre><code>// Socket clientSocket = new Socket(...);
Socket clientSocket = new SecureSocket(..., clientId, clientPrivateKey, callbacks);
</code></pre>
<p>on server:</p>
<pre><code>// ServerSocket serverSocket = new ServerSocket(...);
ServerSocket serverSocket = new SecureServerSocket(..., serverId, serverPrivateKey, callbacks);
</code></pre>
</li>
<li>
<p>Enjoy</p>
</li>
</ol>
<h4 id="basic-secure-session">Basic secure session</h4>
<p>This API is useful when your application already has an established network processing path and this path is more than just using sockets. You just want to  add some function calls which will wrap/unwrap outgoing/incoming buffers with data.</p>
<ol>
<li>
<p>As in case with Secure sockets. Implement <code>ISessionCallbacks</code> interface:</p>
<pre><code>ISessionCallbacks callbacks = new ISessionCallbacks() {
    @Override
    public PublicKey getPublicKeyForId(SecureSession session, byte[] id) {
        // get trusted PublicKey of user id
        PublicKey publicKey = getUserPublicKeyFromDatabaseOrOtherStorageOrSource(id);
        return publicKey; // or null if key is not found
    }

    @Override
    public void stateChanged(SecureSession session) {
        // update UI: for example, draw a nice lock indicating to the user that his communication is now secured
    }
}
</code></pre>
</li>
<li>
<p>Create <code>SecureSession</code> object:</p>
<pre><code>SecureSession session = new SecureSession(yourId, yourPrivateKey, callbacks);
</code></pre>
</li>
<li>
<p>On client side, initiate secure session negotiation by generating and sending connect request:</p>
<pre><code>byte[] connectRequest = session.generateConnectRequest();
// send connectRequest to the server
</code></pre>
</li>
<li>
<p>On both sides begin receiving and parsing incoming data:</p>
<pre><code>// receive some data and store it in receiveBuffer
SecureSession.UnwrapResult result = session.unwrap(receiveBuffer);

switch (result.getDataType()) {
    case USER_DATA:
        // this is actual data that was encrypted by your peer using SecureSession.wrap
        byte[] data = result.getData();
        // process data according to your application flow for incoming data
        break;
    case PROTOCOL_DATA:
        // this is internal secure session protocol data. An opaque response was generated, just send it to your peer
        byte[] data = result.getData();
        // send the data to your peer as is
        break;
    case NO_DATA:
        // this is internal secure session protocol data, but no response is needed (usually happens on the client side when protocol negotiation completes)
        // do nothing
        break;
}
</code></pre>
</li>
<li>
<p>When protocol negotiation completes, you may send encrypted data to your peer:</p>
<pre><code>byte[] wrappedData = session.wrap(yourData);
// send wrappedData to your peer
</code></pre>
</li>
</ol>
<h4 id="secure-session-with-transport-callbacks">Secure session with transport callbacks</h4>
<p>This API is useful when you want to clearly decouple security and network communication in your application:</p>
<ol>
<li>
<p>Implement <code>ITransportSessionCallbacks</code> interface. This interface extends <code>ISessionCallbacks</code> interface, so you have to implement two additional functions:</p>
<pre><code>ITransportSessionCallbacks callbacks = new ITransportSessionCallbacks() {
    // implement getPublicKeyForId and stateChanged as in basic ISessionCallbacks
    ...

    @Override
    public void write(byte[] buffer) {
        // it will be called when secure session needs to send something to your peer
        // just send buffer to your peer
    }

    @Override
    public byte[] read() {
        // here you should issue read request to your underlying transport (for example, read data from socket or pipe)
        // return the buffer with read data
    }
}
</code></pre>
</li>
<li>
<p>Create <code>SecureTransportSession</code> object:</p>
<pre><code>SecureTransportSession session = new SecureTransportSession(yourId, yourPrivateKey, callbacks);
</code></pre>
</li>
<li>
<p>On client side initiate secure session negotiation by sending connect request:</p>
<pre><code>session.connect();
</code></pre>
</li>
<li>
<p>After negotiation completes you may send/receive data on both sides</p>
<pre><code>// sending data
session.write(dataToSend);

...

// receiving data (probably, through a receive loop)
byte[] receivedData = session.read();
</code></pre>
</li>
</ol>
<h3 id="more-examples">More examples</h3>
<p>Android testcases (in the tests directory) are simple self-describing easy-to-understand examples of our APIs usage scenarios. Feel free to explore them a bit.</p></div>
        </div>

	<footer class="col-md-12">
		<hr>
		
		<p>(c) 2015 Cossack Labs Limited</p>
		
		<p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
	</footer>


        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>