machine:
  environment:
    ANDROID_NDK_ROOT: $ANDROID_NDK

## Customize dependencies
dependencies:
  pre:
    - sudo apt-get update && sudo apt-get install libssl-dev python3 python3-setuptools ruby nodejs npm gyp

  override:
    - make SECURE_COMPARATOR=enable
    - sudo make SECURE_COMPARATOR=enable install
    - sudo make SECURE_COMPARATOR=enable themispp_install
    - sudo make SECURE_COMPARATOR=enable pythemis_install
    - sudo make SECURE_COMPARATOR=enable rubythemis_install
    - sudo make SECURE_COMPARATOR=enable phpthemis_install
    - sudo make SECURE_COMPARATOR=enable jsthemis_install
    - make SECURE_COMPARATOR=enable test
    - make SECURE_COMPARATOR=enable themispp_test
    - make SECURE_COMPARATOR=enable test_all

## Customize test commands
test:
  override:
    - build/tests/soter_test
    - build/tests/themis_test
    - build/tests/themispp_test
    - sudo /sbin/ldconfig
    - build/tests/pythemis_test.sh
    - sudo build/tests/rubythemis_test.sh
    - build/tests/phpthemis_test.sh
    - sudo build/tests/node.sh
    # - tests/check_ios_test.sh `tests/start_ios_test.sh`
    # start Android emulator
    - emulator -avd circleci-android22 -no-audio -no-window:
        background: true
    # wait for it to have booted
    - circle-android wait-for-boot
    # run Android tests
    - ./gradlew connectedAndroidTest

