machine:
  environment:
    ANDROID_NDK_ROOT: $ANDROID_NDK

## Customize dependencies
dependencies:
  pre:
    - sudo apt-get install libssl-dev python3 python3-setuptools ruby

  override:
    - make
    - make test
    - make test_all
    - sudo make install
    - sudo make pythemis_install
    - sudo make rubythemis_install
    - sudo make phpthemis_install

## Customize test commands
test:
  override:
    - build/tests/soter_test
    - build/tests/themis_test
    - sudo /sbin/ldconfig
    - build/tests/pythemis_test.sh
    - sudo build/tests/rubythemis_test.sh
    - build/tests/phpthemis_test.sh
    - tests/check_ios_test.sh `tests/start_ios_test.sh`
    # start Android emulator
    #- emulator -avd circleci-android22 -no-audio -no-window:
    #    background: true
    # wait for it to have booted
    #- circle-android wait-for-boot
    # run Android tests
    #- ./gradlew connectedAndroidTest

